<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Edit Job · Job Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />

  <style>
    html, body {
      height: 100%;
      margin: 0;
      background-color: #f8f9fa;
    }

    .navbar {
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1030;
      height: 70px;
    }

    .navbar-brand-centered {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.8rem;
      font-weight: bold;
      color: #fff;
      text-decoration: none;
      white-space: nowrap;
    }

    main {
      flex: 1;
    }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container position-relative">
      <a class="navbar-brand navbar-brand-centered" href="/dashboard">Job Tracker</a>
      <div class="navbar-logout ms-auto">
        <a href="/logout" class="btn btn-outline-light btn-sm">Logout</a>
      </div>
    </div>
  </nav>

  <!-- Centered form box -->
  <main class="flex-grow flex justify-center items-center px-4 pt-24">
    <div class="max-w-2xl w-full p-6 bg-white rounded-xl shadow">
      <h2 class="text-2xl mb-4 font-semibold text-gray-800 text-center">Edit Job</h2>

      <form id="editJobForm" class="space-y-4" data-job-id="{{ job.id }}">
        <div>
          <label for="title" class="block mb-1 text-sm font-medium text-gray-700">Title</label>
          <input
            type="text"
            name="title"
            id="title"
            value="{{ job.title }}"
            required
            class="w-full p-2 rounded bg-gray-100 text-black"
          />
        </div>

        <div>
          <label for="company" class="block mb-1 text-sm font-medium text-gray-700">Company</label>
          <input
            type="text"
            name="company"
            id="company"
            value="{{ job.company }}"
            required
            class="w-full p-2 rounded bg-gray-100 text-black"
          />
        </div>

        <div>
          <label for="location" class="block mb-1 text-sm font-medium text-gray-700">Location</label>
          <input
            type="text"
            name="location"
            id="location"
            value="{{ job.location or '' }}"
            class="w-full p-2 rounded bg-gray-100 text-black"
          />
        </div>

        <div>
          <label for="link" class="block mb-1 text-sm font-medium text-gray-700">Job Link</label>
          <input
            type="url"
            name="link"
            id="link"
            value="{{ job.link or '' }}"
            class="w-full p-2 rounded bg-gray-100 text-black"
          />
        </div>

        <div>
          <label for="applied_date" class="block mb-1 text-sm font-medium text-gray-700">Applied Date</label>
          <input
            type="date"
            name="applied_date"
            id="applied_date"
            value="{{ job.applied_date }}"
            required
            class="w-full p-2 rounded bg-gray-100 text-black"
          />
        </div>

        <div>
          <label for="status" class="block mb-1 text-sm font-medium text-gray-700">Application Status</label>
          <select
            name="status"
            id="status"
            required
            class="w-full p-2 rounded bg-gray-100 text-black"
          >
            <option value="Applied" {% if job.status == 'Applied' %}selected{% endif %}>Applied</option>
            <option value="Interviewing" {% if job.status == 'Interviewing' %}selected{% endif %}>Interviewing</option>
            <option value="Offer Received" {% if job.status == 'Offer Received' %}selected{% endif %}>Offer Received</option>
            <option value="Rejected" {% if job.status == 'Rejected' %}selected{% endif %}>Rejected</option>
            <option value="Saved" {% if job.status == 'Saved' %}selected{% endif %}>Saved</option>
          </select>
        </div>

        <div>
          <label for="notes" class="block mb-1 text-sm font-medium text-gray-700">Notes</label>
          <textarea
            name="notes"
            id="notes"
            rows="4"
            class="w-full p-2 rounded bg-gray-100 text-black"
          >{{ job.notes or '' }}</textarea>
        </div>

        <button
          type="submit"
          class="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded text-white"
        >
          Update Job
        </button>

        <p id="errorMsg" class="text-red-600 text-sm mt-2 text-center hidden"></p>
      </form>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white border-t py-6 mt-auto">
    <div class="max-w-5xl mx-auto text-center text-sm text-gray-600">
      <p>© 2025 <strong>Dino Jackson</strong></p>
      <p class="mt-1">
        <a href="mailto:jacksondino00@gmail.com" class="hover:underline text-blue-600">jacksondino00@gmail.com</a> ·
        <a href="https://www.linkedin.com/in/dino-jackson-486840368/" target="_blank" class="hover:underline text-blue-600">LinkedIn</a> ·
        <a href="https://github.com/Dno-J" target="_blank" class="hover:underline text-blue-600">GitHub</a>
      </p>
    </div>
  </footer>

  <script>
    const form = document.getElementById('editJobForm');
    const errorMsg = document.getElementById('errorMsg');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const jobId = form.dataset.jobId;
      const formData = new FormData(form);
      const data = {
        title: formData.get("title"),
        company: formData.get("company"),
        location: formData.get("location") || null,
        link: formData.get("link") || null,
        applied_date: formData.get("applied_date"),
        status: formData.get("status"),
        notes: formData.get("notes") || null
      };

      try {
        const response = await fetch(`/api/jobs/${jobId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (response.ok) {
          window.location.href = '/dashboard';
        } else {
          const result = await response.json();
          errorMsg.textContent = result.detail || "Failed to update job.";
          errorMsg.classList.remove("hidden");
        }
      } catch (err) {
        errorMsg.textContent = "Network error. Try again.";
        errorMsg.classList.remove("hidden");
      }
    });
  </script>
</body>
</html>
