<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard · Job Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap (Navbar) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Tailwind CSS (Cards & Tables) -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />

  <style>
    html, body {
      height: 100%;
      margin: 0;
      background-color: #f8f9fa;
    }

    body {
      padding-top: 70px; /* navbar height */
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    main {
      flex: 1;
    }

    .navbar {
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1030;
      height: 70px;
    }

    .navbar-brand-centered {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.8rem;
      font-weight: bold;
      color: #fff;
      text-decoration: none;
      white-space: nowrap;
    }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container position-relative">
      <a class="navbar-brand navbar-brand-centered" href="/dashboard">Job Tracker</a>
      <div class="navbar-logout ms-auto">
        <a href="/logout" class="btn btn-outline-light btn-sm">Logout</a>
      </div>
    </div>
  </nav>

  <!-- Main content -->
  <main class="max-w-6xl w-full mx-auto px-4 mt-8">

    <!-- Page Title -->
    <h2 class="text-2xl font-semibold mb-4 text-gray-800">Your Applications</h2>

    <!-- Summary Grid -->
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
      {% for label in ['Total', 'Applied', 'Interviewing', 'Offer Received', 'Rejected', 'Saved'] %}
        <div class="bg-white p-4 rounded shadow text-center">
          <p class="text-gray-500 text-sm">{{ label }}</p>
          <p class="text-xl font-semibold text-blue-700">
            {{ summary[label] if label in summary else 0 }}
          </p>
        </div>
      {% endfor %}
    </div>

    <!-- Charts -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <!-- Pie Chart -->
      <section class="bg-white p-4 rounded shadow" aria-label="Status Overview Chart">
        <h3 class="text-lg font-bold mb-2">Status Overview</h3>
        {% if status_chart %}
          <img src="{{ status_chart }}" alt="Pie chart showing job statuses" class="w-full h-auto rounded" />
        {% else %}
          <p class="text-gray-500 italic">No status data available.</p>
        {% endif %}
      </section>

      <!-- Line Chart -->
      <section class="bg-white p-4 rounded shadow" aria-label="Applications Over Time Chart">
        <h3 class="text-lg font-bold mb-2">Applications Over Time</h3>
        {% if time_chart %}
          <img src="{{ time_chart }}" alt="Line chart of job applications over time" class="w-full h-auto rounded" />
        {% else %}
          <p class="text-gray-500 italic">No timeline data available.</p>
        {% endif %}
      </section>
    </div>

    <!-- Filters -->
    <div class="mb-6 flex flex-wrap gap-2" role="list">
      {% for label in ['All', 'Applied', 'Interviewing', 'Offer Received', 'Rejected', 'Saved'] %}
        <a href="/dashboard/?status={{ label }}" role="listitem"
           class="px-4 py-2 rounded text-sm font-medium border transition
           {% if (not status_filter and label == 'All') or (status_filter|lower == label|lower) %}
             bg-blue-600 text-white
           {% else %}
             bg-white text-gray-800 border-gray-300 hover:bg-blue-100
           {% endif %}">
          {{ label }}
        </a>
      {% endfor %}
    </div>

    <!-- Job Applications Table -->
    <div class="overflow-x-auto bg-white rounded shadow">
      <table class="min-w-full text-left text-sm" role="table" aria-label="Job Applications">
        <thead class="bg-gray-200 text-gray-600 uppercase text-xs">
          <tr>
            <th scope="col" class="px-6 py-3">Title</th>
            <th scope="col" class="px-6 py-3">Company</th>
            <th scope="col" class="px-6 py-3">Location</th>
            <th scope="col" class="px-6 py-3">Status</th>
            <th scope="col" class="px-6 py-3">Applied</th>
            <th scope="col" class="px-6 py-3">Notes</th>
            <th scope="col" class="px-6 py-3">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y">
          {% if jobs %}
            {% for job in jobs %}
              <tr class="hover:bg-gray-50" id="job-{{ job.id }}">
                <td class="px-6 py-4 font-medium text-gray-900">{{ job.title }}</td>
                <td class="px-6 py-4">{{ job.company }}</td>
                <td class="px-6 py-4">{{ job.location or '-' }}</td>
                <td class="px-6 py-4">{{ job.status }}</td>
                <td class="px-6 py-4">{{ job.applied_date }}</td>
                <td class="px-6 py-4 text-gray-700 italic">{{ job.notes or '-' }}</td>
                <td class="px-6 py-4">
                  <div class="flex items-center space-x-3">
                    {% if job.link %}
                      <a href="{{ job.link }}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">View</a>
                    {% endif %}
                    <a href="/jobs/edit-job/{{ job.id }}" class="text-yellow-600 hover:underline">Edit</a>
                    <button type="button" onclick="deleteJob({{ job.id }})" class="text-red-600 hover:underline bg-transparent border-0 p-0 cursor-pointer">
                      Delete
                    </button>
                  </div>
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td class="px-6 py-4 text-gray-500 italic" colspan="7">No job applications found.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    <!-- Action Buttons -->
    <div class="mt-6 flex justify-center gap-4">
      <a href="/jobs/add-job" class="inline-block bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">
        Add New Job
      </a>
      <a href="/jobs/export/csv" class="inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
        Export CSV
      </a>
      <a href="/jobs/export/pdf" class="inline-block bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition">
        Export PDF
      </a>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white border-t py-6">
    <div class="max-w-5xl mx-auto text-center text-sm text-gray-600">
      <p>© 2025 <strong>Dino Jackson</strong></p>
      <p class="mt-1">
        <a href="mailto:jacksondino00@gmail.com" class="hover:underline text-blue-600">jacksondino00@gmail.com</a> ·
        <a href="https://www.linkedin.com/in/dino-jackson-486840368/" target="_blank" rel="noopener noreferrer" class="hover:underline text-blue-600">LinkedIn</a> ·
        <a href="https://github.com/Dno-J" target="_blank" rel="noopener noreferrer" class="hover:underline text-blue-600">GitHub</a>
      </p>
    </div>
  </footer>

  <!-- JS for deleting a job -->
  <script>
    async function deleteJob(jobId) {
      const confirmDelete = confirm("Are you sure you want to delete this job?");
      if (!confirmDelete) return;

      try {
        const response = await fetch(`/api/jobs/${jobId}`, {
          method: "DELETE"
        });

        if (response.ok) {
          document.getElementById(`job-${jobId}`).remove();
        } else {
          alert("Failed to delete job. Please try again.");
        }
      } catch (error) {
        console.error("Error:", error);
        alert("An error occurred. Please try again later.");
      }
    }
  </script>
</body>
</html>
